<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ad Reward Feed</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: #000;
      font-family: sans-serif;
    }

    #feed {
      height: 100vh;
      overflow-y: scroll;
      scroll-snap-type: y mandatory;
    }

    .ad-slide {
      height: 100vh;
      scroll-snap-align: start;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #111;
      color: #fff;
      font-size: 2rem;
      position: relative;
    }

    .slide-content {
      z-index: 1;
      text-align: center;
    }

    .overlay {
      position: absolute;
      top: 0; bottom: 0;
      left: 0; right: 0;
      z-index: 0;
    }

    .indicator {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1rem;
      opacity: 0.7;
    }
  </style>
</head>
<body>

  <div id="feed"></div>

  <!-- ✅ Adsterra Social Bar Script -->
  <script type='text/javascript' src='//pl26408161.profitableratecpm.com/f9/df/f2/f9dff23c91b1b7e6f98cd017d227178e.js'></script>

  <script>
    const feed = document.getElementById('feed');
    let currentSlide = 0;
    let rewarded = {};
    let timers = {};
    let totalSlides = 0;

    // Function to create ad slide
    function createAdSlide(index) {
      const slide = document.createElement('div');
      slide.className = 'ad-slide';
      slide.dataset.index = index;

      const content = document.createElement('div');
      content.className = 'slide-content';
      content.textContent = `Ad ${index + 1}`;

      const overlay = document.createElement('div');
      overlay.className = 'overlay';

      const indicator = document.createElement('div');
      indicator.className = 'indicator';
      indicator.textContent = 'Watch this ad for 15s to earn rewards';

      slide.appendChild(content);
      slide.appendChild(overlay);
      slide.appendChild(indicator);
      return slide;
    }

    // Load more ads dynamically
    function loadSlides(count = 3) {
      for (let i = 0; i < count; i++) {
        const slide = createAdSlide(totalSlides++);
        feed.appendChild(slide);
      }
    }

    // Start reward timer
    function startTimer(index) {
      if (rewarded[index]) return;
      timers[index] = setTimeout(() => {
        rewarded[index] = true;
        console.log(`✅ Ad ${index + 1} viewed. Reward granted.`);

        // Send reward to WebView (WebView2)
        if (window.chrome && window.chrome.webview) {
          window.chrome.webview.postMessage("adViewed");
        }

        // Or send to native Android WebView
        if (window.ReactNativeWebView) {
          window.ReactNativeWebView.postMessage("adViewed");
        }

        // Or send to backend API (custom)
        fetch("/api/ad-viewed", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            slide: index,
            timestamp: new Date().toISOString(),
          }),
        }).catch(e => console.warn("Tracking failed:", e));

      }, 15000); // 15s required
    }

    // Stop reward timer
    function stopTimer(index) {
      if (timers[index]) {
        clearTimeout(timers[index]);
        timers[index] = null;
      }
    }

    // Scroll handler
    function handleScroll() {
      const newIndex = Math.floor(feed.scrollTop / window.innerHeight);
      if (newIndex !== currentSlide) {
        stopTimer(currentSlide);
        startTimer(newIndex);
        currentSlide = newIndex;

        // Load more slides if near bottom
        if (newIndex + 2 >= totalSlides) {
          loadSlides(3);
        }
      }
    }

    feed.addEventListener('scroll', () => {
      window.requestAnimationFrame(handleScroll);
    });

    // Initial setup
    loadSlides(5);
    startTimer(0);
  </script>
</body>
</html>

</html>



